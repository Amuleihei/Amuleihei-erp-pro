<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.skyeye.eve.dao.SysEnclosureDao">
	
	<select id="querySysEnclosureFirstTypeListByUserId" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			a.id,
			a.type_name `name`,
			'1' pId,
			'../../assets/images/my-folder-icon.png' icon,
			1 isParent
		FROM
			sys_enclosure_type a
		WHERE
			a.parent_id = '0'
		AND a.create_id = #{userId}
	</select>
	
	<select id="querySysEnclosureSecondTypeListByUserId" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			a.id,
			a.type_name `name`,
			a.parent_id pId,
			'../../assets/images/my-folder-icon.png' icon,
			0 isParent
		FROM
			sys_enclosure_type a
		WHERE
			a.parent_id = #{parentId}
		AND a.create_id = #{userId}
	</select>
	
	<select id="querySysEnclosureMationByUserIdAndParentId" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			a.id,
			a.parent_id parentId
		FROM
			sys_enclosure_type a
		WHERE
			a.id = #{parentId}
		AND a.create_id = #{userId}
	</select>
	
	<insert id="insertSysEnclosureMationByUserId" parameterType="java.util.Map">
	    INSERT into sys_enclosure_type 
	    (id, type_name, parent_id, `state`, create_id, create_time)
	    VALUES(#{id}, #{typeName}, #{parentId}, #{state}, #{userId}, #{createTime})
	</insert>
	
	<select id="queryThisFolderChilsByFolderId" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			*
		FROM
			(SELECT
				a.id,
				a.type_name `name`,
				'folder' fileType,
				'' fileSize,
				DATE_FORMAT(a.create_time, '%Y-%m-%d %H:%i') createTime,
				'2' orderBy,
				'' fileAddress
			FROM
				sys_enclosure_type a
			WHERE
				a.parent_id = #{parentId}
			AND a.create_id = #{userId}
			UNION ALL
			SELECT
				b.id,
				b.file_name `name`,
				b.file_type fileType,
				b.file_size fileSize,
				DATE_FORMAT(b.create_time, '%Y-%m-%d %H:%i') createTime,
				'1' orderBy,
				b.file_address fileAddress
			FROM
				sys_enclosure b
			WHERE
				b.parent_id = #{parentId}
			AND b.create_id = #{userId}) k
		ORDER BY k.orderBy DESC
	</select>
	
	<select id="querySysEnclosureMationByUserIdToEdit" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT * FROM 
		(SELECT
			a.type_name typeName
		FROM
			sys_enclosure_type a
		WHERE
			a.id = #{id}
		UNION
		SELECT
			b.file_name typeName
		FROM
			sys_enclosure b
		WHERE
			b.id = #{id}) k
		LIMIT 1
	</select>
	
	<update id="editSysEnclosureFolderMationByUserId" parameterType="java.util.Map">
		UPDATE sys_enclosure_type
		<set>
			type_name = #{typeName}
		</set>
		WHERE id = #{id}
	</update>
	
	<update id="editSysEnclosureFileMationByUserId" parameterType="java.util.Map">
		UPDATE sys_enclosure
		<set>
			file_name = #{typeName}
		</set>
		WHERE id = #{id}
	</update>
	
	<insert id="insertUploadFileByUserId" parameterType="java.util.Map">
	    INSERT into sys_enclosure 
	    (id, file_name, file_address, file_type, file_size, file_size_type, parent_id, create_id, create_time)
	    VALUES(#{id}, #{name}, #{fileAddress}, #{fileType}, #{size}, #{fileSizeType}, #{folderId}, #{createId}, #{createTime})
	</insert>
	
	<select id="querySysEnclosureListToTreeByUserId" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			*
		FROM
			(SELECT
				a.id,
				a.type_name `name`,
				'folder' fileType,
				'' fileSize,
				DATE_FORMAT(a.create_time, '%Y-%m-%d %H:%i') createTime,
				'2' orderBy,
				'' fileAddress,
				a.parent_id pId,
				1 isParent,
				'../../assets/images/my-folder-icon.png' `icon`
			FROM
				sys_enclosure_type a
			WHERE
				a.create_id = #{userId}
			UNION ALL
			SELECT
				b.id,
				b.file_name `name`,
				b.file_type fileType,
				b.file_size fileSize,
				DATE_FORMAT(b.create_time, '%Y-%m-%d %H:%i') createTime,
				'1' orderBy,
				b.file_address fileAddress,
				b.parent_id pId,
				0 isParent,
				'../../assets/images/my-file-icon.png' `icon`
			FROM
				sys_enclosure b
			WHERE
				b.create_id = #{userId}) k
		ORDER BY k.orderBy DESC
	</select>
	
	<select id="queryEnclosureInfo" resultType="java.util.Map">
		SELECT
			id,
			file_name name,
			file_address fileAddress
		FROM
			sys_enclosure
		WHERE instr(concat(',', #{enclosure},','),concat(',', id, ','));
	</select>
	
</mapper>